_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:8000
    routes:
      - name: auth-routes
        paths: ["/api/v1/auth", "/api/v1/users", "/api/v1/organizations", "/api/v1/admin", "/api/v1/health"]
        strip_path: false

  - name: competitions-service
    url: http://competitions-service:8001
    routes:
      - name: competitions-routes
        paths: ["/api/v1/competitions", "/api/v1/matches", "/api/v1/teams", "/api/v1/modalities"]
        strip_path: false

  - name: mediamtx-hls
    url: http://mediamtx:8888
    routes:
      - name: hls-stream
        paths:
          - /live
        protocols:
          - http
          - https
        strip_path: false
        preserve_host: true

  - name: livestream-service
    url: http://livestream-service:3333
    routes:
      - name: livestream-routes
        paths: ["/api/v1/lives", "/api/v1/google-calendar", "/api/v1/webhooks"]
        strip_path: false
      
      - name: livestream-socket
        paths:
          - /socket.io
        protocols:
          - http
          - https
        strip_path: false
        preserve_host: true

  - name: notifications-service
    url: http://notifications-service:8003
    routes:
      - name: notifications-routes
        paths: ["/api/v1/notifications", "/api/v1/notifications/stream", "/api/v1/ws/notifications", "/api/v1/notifications/"]
        strip_path: false

  - name: keycloak-service
    url: http://keycloak:8080
    routes:
      - name: keycloak-routes
        paths: 
          - /keycloak
        strip_path: false
        preserve_host: true

  - name: frontend-service
    url: http://frontend:3000
    routes:
      - name: frontend-routes
        paths:
          - /
        strip_path: false

plugins:
  - name: cors
    config:
      origins: ["http://athloshub.com.br"]
      methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS", "HEAD"]
      headers: ["Accept", "Accept-Version", "Content-Length", "Content-MD5", "Content-Type", "Date", "X-Auth-Token", "Authorization", "X-Requested-With", "X-Request-Id", "X-User-Id"]
      credentials: true