_format_version: "3.0"
_transform: true


services:
  - name: auth-service
    url: http://host.docker.internal:8000
    tags:
      - auth
    routes:
      - name: auth-health
        paths:
          - /api/v1/health
        strip_path: false
        tags:
          - public
          - health

      - name: auth-routes
        paths:
          - /api/v1/auth
        strip_path: false
        tags:
          - auth

      - name: users-routes
        paths:
          - /api/v1/users
        strip_path: false
        tags:
          - users

      - name: organizations-routes
        paths:
          - /api/v1/organizations
        strip_path: false
        tags:
          - organizations

      - name: admin-routes
        paths:
          - /api/v1/admin
        strip_path: false
        tags:
          - admin

  - name: competitions-service
    url: http://host.docker.internal:8001
    tags:
      - competitions
    routes:
      - name: competitions-routes
        paths:
          - /api/v1/competitions
        strip_path: false
        tags:
          - competitions

      - name: matches-routes
        paths:
          - /api/v1/matches
        strip_path: false
        tags:
          - matches

      - name: teams-routes
        paths:
          - /api/v1/teams
        strip_path: false
        tags:
          - teams

      - name: modalities-routes
        paths:
          - /api/v1/modalities
        strip_path: false
        tags:
          - modalities

  - name: livestream-service
    url: http://host.docker.internal:3333
    tags:
      - livestream
    routes:
      - name: lives-routes
        paths:
          - /api/v1/lives
        strip_path: false
        tags:
          - lives

      - name: google-calendar-routes
        paths:
          - /api/v1/google-calendar
        strip_path: false
        tags:
          - google-calendar

      - name: livestream-webhooks
        paths:
          - /api/v1/webhooks
        strip_path: false
        tags:
          - webhooks

  - name: notifications-service
    url: http://host.docker.internal:8003
    tags:
      - notifications
    routes:
      # Notificações
      - name: notifications-routes
        paths:
          - /api/v1/notifications
        strip_path: false
        tags:
          - notifications

plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://127.0.0.1:3000
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
        - HEAD
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
        - Authorization
        - X-Requested-With
        - X-Request-Id
        - X-User-Id
      exposed_headers:
        - X-Auth-Token
        - X-Request-Id
      credentials: true
      max_age: 3600
      preflight_continue: false

  - name: rate-limiting
    config:
      minute: 200
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  - name: file-log
    config:
      path: /dev/stdout
      reopen: true

  - name: request-size-limiting
    config:
      allowed_payload_size: 10
      size_unit: megabytes
