_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://host.docker.internal:8000
    routes:
      - name: auth-routes
        paths: ["/api/v1/auth", "/api/v1/users", "/api/v1/organizations", "/api/v1/admin", "/api/v1/health"]
        strip_path: false

  - name: competitions-service
    url: http://host.docker.internal:8001
    routes:
      - name: competitions-routes
        paths: ["/api/v1/competitions", "/api/v1/matches", "/api/v1/teams", "/api/v1/modalities"]
        strip_path: false

  - name: mediamtx-hls
    url: http://mediamtx:8888
    routes:
      - name: hls-stream
        paths:
          - /live
        protocols:
          - http
          - https
        strip_path: false
        preserve_host: true

  - name: livestream-service
    url: http://host.docker.internal:3333
    routes:
      - name: livestream-routes
        paths: ["/api/v1/lives", "/api/v1/google-calendar", "/api/v1/webhooks"]
        strip_path: false
      
      - name: livestream-socket
        paths:
          - /socket.io
        protocols:
          - http
          - https
        strip_path: false
        preserve_host: true

  - name: notifications-service
    url: http://host.docker.internal:8003
    routes:
      - name: notifications-combined-routes
        paths: ["/api/v1/notifications"]
        strip_path: false
        methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
        request_buffering: false
        response_buffering: false
      
      - name: notifications-sse-stream
        paths: ["/api/v1/notifications/stream"]
        strip_path: false
        protocols:
          - http
          - https
        preserve_host: true
        request_buffering: false
        response_buffering: false

  - name: keycloak-service
    url: http://keycloak-local:8080/keycloak
    routes:
      - name: keycloak-routes
        paths:
          - /keycloak
        strip_path: true
        preserve_host: true

  - name: frontend-service
    url: http://host.docker.internal:3000
    routes:
      - name: frontend-routes
        paths:
          - /
        strip_path: false
        preserve_host: true

plugins:
  - name: cors
    config:
      origins: 
        - "http://athloshub.com.br"
        - "http://localhost:8100"
        - "http://localhost:3000"
      methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS", "HEAD"]
      headers:
        - "Accept"
        - "Accept-Version"
        - "Content-Length"
        - "Content-MD5"
        - "Content-Type"
        - "Date"
        - "X-Auth-Token"
        - "Authorization"
        - "X-Requested-With"
        - "X-Request-Id"
        - "X-User-Id"
        - "Cache-Control"
        - "Connection"
        - "Keep-Alive"
      exposed_headers:
        - "Cache-Control"
        - "Connection"
        - "Content-Type"
        - "Date"
        - "Keep-Alive"
        - "Transfer-Encoding"
        - "X-Accel-Buffering"
      credentials: true
      max_age: 3600